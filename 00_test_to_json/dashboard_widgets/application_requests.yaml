definition:
  title: "Services"
  background_color: "vivid_blue"
  show_title: true
  type: "group"
  layout_type: "ordered"
  widgets:
    - id: 1736323808171077
      layout:
        x: 0
        "y": 0
        width: 12
        height: 1
      definition:
        type: "note"
        content: "## Health & Event"
        background_color: "blue"
        font_size: "36"
        text_align: "center"
        vertical_align: "center"
        show_tick: true
        tick_pos: "50%"
        tick_edge: "left"
        has_padding: true
    - id: 3833959094031737
      layout:
        x: 2
        "y": 1
        width: 5
        height: 3
      definition:
        title: "Service Monitors"
        type: "manage_status"
        display_format: "countsAndList"
        color_preference: "background"
        hide_zero_counts: true
        show_status: true
        last_triggered_format: "relative"
        query: "$team $env"
        sort: "status,asc"
        count: 50
        start: 0
        summary_type: "monitors"
        show_priority: true
        show_last_triggered: false
    - id: 106805208976973
      layout:
        x: 7
        "y": 1
        width: 5
        height: 3
      definition:
        title: "Dependency Map"
        title_size: "16"
        title_align: "left"
        type: "topology_map"
        requests:
          - query:
              data_source: "service_map"
              filters:
                - "$env"
              service: "$service"
              query_string: "service:($service.value)"
            request_type: "topology"
    - id: 7074867250317244
      layout:
        x: 2
        "y": 4
        width: 10
        height: 1
      definition:
        type: "note"
        content: "## Resource Utilization"
        background_color: "orange"
        font_size: "36"
        text_align: "center"
        vertical_align: "center"
        show_tick: true
        tick_pos: "50%"
        tick_edge: "left"
        has_padding: true
    - id: 2129964225235122
      layout:
        x: 2
        "y": 5
        width: 5
        height: 2
      definition:
        title: "Pods Number"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - formula: "query1"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:kubernetes.pods.running{$env,kube_namespace:$namespace.value, $service} by {kube_app_name}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "bars"
        markers:
          - label: "y > 2"
            value: "y > 2"
            display_type: "ok dashed"
          - label: "y < 2"
            value: "y < 2"
            display_type: "error dashed"
    - id: 6780386267187339
      layout:
        x: 7
        "y": 5
        width: 5
        height: 2
      definition:
        title: "Pods Restart"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - formula: "query1"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:kubernetes.containers.restarts{$env,service:asset-accounting-backend} by {kube_container_name}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "bars"
        markers:
          - label: "y > 2"
            value: "y > 2"
            display_type: "error dashed"
          - label: "y < 2"
            value: "y < 2"
            display_type: "ok dashed"
    - id: 300813272500088
      layout:
        x: 2
        "y": 7
        width: 5
        height: 2
      definition:
        title: "Memory (remove)"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - alias: "mem_usage"
                formula: "query1"
              - alias: "mem_request"
                formula: "query2"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "avg:kubernetes.memory.usage{kube_namespace:$namespace.value,$env,service:$service.value} by {display_container_name}"
              - name: "query2"
                data_source: "metrics"
                query: "max:kubernetes.memory.requests{kube_namespace:$namespace.value,$env,service:$service.value} by {container_name}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "line"
        markers:
          - label: "y < 4831838208"
            value: "y < 4831838208"
            display_type: "ok dashed"
          - label: "4831838208 < y < 5368709120"
            value: "4831838208 < y < 5368709120"
            display_type: "warning dashed"
          - label: "y > 5368709120"
            value: "y > 5368709120"
            display_type: "error dashed"
    - id: 6981182833900402
      layout:
        x: 7
        "y": 7
        width: 5
        height: 2
      definition:
        title: "Memory Percent"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - formula: "query1"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "avg:kubernetes.memory.usage_pct{kube_namespace:*asset-accounting*,container_name:aa-backend,$env} by {display_container_name}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "line"
        markers:
          - label: " 75% "
            value: "y < 0.75"
            display_type: "ok dashed"
          - label: " 75%-85% "
            value: "0.75 < y < 0.85"
            display_type: "warning dashed"
          - label: " 85% "
            value: "y > 0.85"
            display_type: "error dashed"
    - id: 286630901699322
      layout:
        x: 2
        "y": 9
        width: 5
        height: 2
      definition:
        title: "CPU (change to percentage)"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - alias: "cpu_usage"
                formula: "query1"
              - alias: "cpu_request"
                style:
                  palette: "red"
                formula: "query2"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "avg:kubernetes.cpu.usage.total{$env,$service,kube_namespace:$namespace.value} by {display_container_name}"
              - name: "query2"
                data_source: "metrics"
                query: "max:kubernetes.cpu.requests{$env,$service,kube_namespace:$namespace.value} by {container_name}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "line"
        markers:
          - label: "y < 1.6"
            value: "y < 1.6"
            display_type: "ok dashed"
          - label: "1.6 < y < 1.8"
            value: "1.6 < y < 1.8"
            display_type: "warning dashed"
          - label: "y > 1.8"
            value: "y > 1.8"
            display_type: "error dashed"
    - id: 5871113813390191
      layout:
        x: 7
        "y": 9
        width: 5
        height: 2
      definition:
        title: "Disk IO Read/Write"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - alias: "cpu_usage"
                style:
                  palette: "dog_classic"
                formula: "query1"
              - alias: "cpu_request"
                formula: "query2"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "avg:kubernetes.io.read_bytes{kube_namespace:*asset-accounting*,container_name:aa-backend,$env} by {display_container_name}"
              - name: "query2"
                data_source: "metrics"
                query: "avg:kubernetes.io.write_bytes{kube_namespace:*asset-accounting*,container_name:aa-backend,$env} by {display_container_name}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "line"
        markers: []
    - id: 5454379352059804
      layout:
        x: 2
        "y": 11
        width: 5
        height: 2
      definition:
        title: "Network Receive and Transmit"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - alias: "receive"
                formula: "query1"
              - alias: "transmit"
                formula: "query2"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:kubernetes.network.rx_bytes{$env, $service}"
              - name: "query2"
                data_source: "metrics"
                query: "sum:kubernetes.network.tx_bytes{$env, $service}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "line"
        markers: []
    - id: 8883377818799084
      layout:
        x: 7
        "y": 11
        width: 5
        height: 2
      definition:
        title: "Network Errors Receive and Transmit"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - alias: "receive"
                formula: "query1"
              - alias: "transmit"
                formula: "query2"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:kubernetes.network.rx_errors{$env, $service}"
              - name: "query2"
                data_source: "metrics"
                query: "sum:kubernetes.network.tx_errors{$env, $service}"
            response_format: "timeseries"
            style:
              palette: "dog_classic"
              order_by: "values"
              color_order: "shuffled"
              line_type: "solid"
              line_width: "normal"
            display_type: "line"
        markers: []
    - id: 1127155075950384
      layout:
        x: 2
        "y": 13
        width: 10
        height: 1
      definition:
        type: "note"
        content: "## Application performance"
        background_color: "pink"
        font_size: "36"
        text_align: "center"
        vertical_align: "center"
        show_tick: true
        tick_pos: "50%"
        tick_edge: "left"
        has_padding: true
    - id: 87152102965845
      layout:
        x: 2
        "y": 14
        width: 5
        height: 2
      definition:
        title: "ALB: API Error Rate"
        title_size: "16"
        title_align: "left"
        type: "query_value"
        requests:
          - response_format: "scalar"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:aws.applicationelb.httpcode_elb_5xx{ingress.k8s.aws/stack:*asset-accounting/aa-alb-public,$env}.as_count()"
                aggregator: "sum"
              - name: "query2"
                data_source: "metrics"
                query: "sum:aws.applicationelb.httpcode_target_5xx{ingress.k8s.aws/stack:*asset-accounting/aa-alb-public,$env}.as_count()"
                aggregator: "sum"
              - name: "query3"
                data_source: "metrics"
                query: "sum:aws.applicationelb.request_count{ingress.k8s.aws/stack:*asset-accounting/aa-alb-public,$env}.as_count()"
                aggregator: "sum"
            formulas:
              - formula: "((query1 + query2) / query3) * 100"
            conditional_formats:
              - comparator: ">="
                value: 0.001
                palette: "white_on_yellow"
              - comparator: ">="
                value: 0.003
                palette: "white_on_red"
              - comparator: "<"
                value: 0.001
                palette: "white_on_green"
        autoscale: false
        text_align: "center"
        precision: 4
        timeseries_background:
          yaxis:
            include_zero: false
          type: "area"
    - id: 3115870752647582
      layout:
        x: 7
        "y": 14
        width: 5
        height: 2
      definition:
        title: "ALB: API latency P95"
        title_size: "16"
        title_align: "left"
        type: "query_value"
        requests:
          - response_format: "scalar"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "avg:aws.applicationelb.target_response_time.p95{$env,ingress.k8s.aws/stack:*asset-accounting/aa-alb-public}"
                aggregator: "avg"
            conditional_formats:
              - comparator: ">="
                value: 0.2
                palette: "white_on_yellow"
              - comparator: ">="
                value: 0.5
                palette: "white_on_red"
              - comparator: "<"
                value: 2
                palette: "white_on_green"
            formulas:
              - formula: "query1"
        autoscale: true
        precision: 2
        timeseries_background:
          yaxis:
            include_zero: false
          type: "area"
    - id: 5666851836132190
      layout:
        x: 2
        "y": 16
        width: 5
        height: 2
      definition:
        title: "ALB: Request Count (remove)"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - alias: "alb"
                formula: "query1"
            queries:
              - query: "avg:aws.applicationelb.request_count{$env,$team} by {loadbalancer}.as_count()"
                data_source: "metrics"
                name: "query1"
            response_format: "timeseries"
            style:
              palette: "blue"
            display_type: "bars"
    - id: 1305836082603362
      layout:
        x: 7
        "y": 16
        width: 5
        height: 2
      definition:
        title: "ALB: Request Rate"
        title_size: "16"
        title_align: "left"
        type: "query_value"
        requests:
          - formulas:
              - formula: "query1"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:aws.applicationelb.request_count{$env,$team}.as_rate()"
                aggregator: "max"
            response_format: "scalar"
        autoscale: true
        precision: 2
        timeseries_background:
          type: "area"
    - id: 1997678994766062
      layout:
        x: 2
        "y": 18
        width: 5
        height: 3
      definition:
        title: "Application: Request Hits By Http Status (remove)"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - formula: "query1"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:trace.http.request.hits.by_http_status{$env,service:asset-accounting-backend} by {http.status_code}.as_count()"
            response_format: "timeseries"
            style:
              palette: "semantic"
              order_by: "values"
              color_order: "shuffled"
              order_reverse: false
              line_type: "solid"
              line_width: "normal"
            display_type: "bars"
    - id: 2600285935494018
      layout:
        x: 7
        "y": 18
        width: 5
        height: 3
      definition:
        title: "Application: Distribution of HTTP response codes"
        title_size: "16"
        title_align: "left"
        requests:
          - queries:
              - data_source: "metrics"
                name: "query1"
                query: "sum:trace.http.request.hits.by_http_status{service:asset-accounting-backend,$env} by {http.status_code}.as_count()"
                aggregator: "last"
            response_format: "scalar"
            style:
              palette: "semantic"
            formulas:
              - formula: "query1"
            sort:
              count: 500
              order_by:
                - type: "formula"
                  index: 0
                  order: "desc"
        type: "sunburst"
        hide_total: false
        legend:
          type: "automatic"
    - id: 165366499120846
      layout:
        x: 2
        "y": 21
        width: 5
        height: 2
      definition:
        title: "Application: Request Hits (need to be updated)"
        title_size: "16"
        title_align: "left"
        show_legend: true
        legend_layout: "auto"
        legend_columns:
          - "avg"
          - "min"
          - "max"
          - "value"
          - "sum"
        type: "timeseries"
        requests:
          - formulas:
              - formula: "query1"
              - formula: "query2"
            queries:
              - name: "query1"
                data_source: "metrics"
                query: "sum:trace.http.request.hits{$env,service:asset-accounting-backend}.as_count()"
              - name: "query2"
                data_source: "metrics"
                query: "avg:aws.applicationelb.request_count{$env,$team} by {loadbalancer}.as_count()"
            response_format: "timeseries"
            style:
              palette: "cool"
              order_by: "values"
              color_order: "shuffled"
              order_reverse: false
              line_type: "solid"
              line_width: "normal"
            display_type: "bars"
    - id: 5371479232141822
      layout:
        x: 7
        "y": 21
        width: 5
        height: 2
      definition:
        title: "Application: Request Latency Top 10"
        title_size: "16"
        title_align: "left"
        type: "toplist"
        requests:
          - queries:
              - name: "query1"
                data_source: "metrics"
                query: "avg:trace.http.request{$env,service:asset-accounting-backend*} by {resource_name}"
                aggregator: "avg"
            response_format: "scalar"
            conditional_formats:
              - comparator: "<="
                value: 0.2
                palette: "white_on_green"
              - comparator: "<="
                value: 0.5
                palette: "white_on_yellow"
              - comparator: ">"
                value: 0.5
                palette: "white_on_red"
            formulas:
              - formula: "query1"
            sort:
              count: 10
              order_by:
                - type: "formula"
                  index: 0
                  order: "desc"
        style:
          display:
            type: "stacked"
            legend: "automatic"
          palette: "dog_classic"
          scaling: "absolute"
